<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>쪽지함</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/message.css" rel="stylesheet" />
</head>
<body>
<!-- 헤더 html 플러그인 -->
<div th:replace="~{ /header.html :: header }"></div>

<div class="container mt-4">
    <h2>전체 쪽지함</h2>
    <div class="message-content">
        <table class="table">
            <thead>
            <tr>
                <th>제목</th>
                <th>상대방</th>
                <th>유형</th>
                <th>날짜</th>
                <th>내용</th>
                <th>삭제</th>
            </tr>
            </thead>
            <tbody>
            <!-- 받은 메시지 목록 -->
            <tr th:each="message : ${receivedMessages}">
                <td th:text="${message.metitle}"></td>
                <td th:text="${message.sendname}"></td>
                <td>받은 쪽지</td>
                <td>날짜</td>
                <td>
                    <button class="btn btn-sm btn-info view-btn" th:data-id="${message.meno}">보기</button>
                </td>
                <td>
                    <button class="btn btn-sm btn-danger delete-btn" th:data-id="${message.meno}" data-type="received">삭제</button>
                </td>
            </tr>
            <!-- 보낸 메시지 목록 -->
            <tr th:each="message : ${sentMessages}">
                <td th:text="${message.metitle}"></td>
                <td th:text="${message.receivername}"></td>
                <td>보낸 쪽지</td>
                <td>날짜</td>
                <td>
                    <button class="btn btn-sm btn-info view-btn" th:data-id="${message.meno}">보기</button>
                </td>
                <td>
                    <button class="btn btn-sm btn-danger delete-btn" th:data-id="${message.meno}" data-type="sent">삭제</button>
                </td>
            </tr>
            </tbody>
        </table>
        <ul class="pagination pagebox"></ul>
    </div>
    <button class="btn btn-primary mt-3" onclick="location.href='/message/write'">쪽지 보내기</button>
</div>

<!-- 메시지 상세 보기 모달 -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="message-info mb-3">
                    <div class="row mb-2">
                        <div class="col-md-2 fw-bold">보낸 사람:</div>
                        <div class="col-md-10" id="modalSender"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 fw-bold">받는 사람:</div>
                        <div class="col-md-10" id="modalReceiver"></div>
                    </div>
                </div>
                <div class="message-content border p-3 bg-light">
                    <div id="modalContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                <button type="button" class="btn btn-primary" id="replyBtn">답장하기</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/js/message/message.js"></script>
</body>
</html>